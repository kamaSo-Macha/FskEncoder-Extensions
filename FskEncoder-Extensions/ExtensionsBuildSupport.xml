<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<project name="Build Extensions Supports">

	<property name="ext.dir.projectRoot"	value="H:/GitRepository/FskEncoder-Extensions/FskEncoder-Extensions" />
	<property name="dir.dist"				value="H:/GitSandbox/FskEncoder/dist" />

	<property name="ext.dir.classesRoot"	value="${ext.dir.projectRoot}/target/classes"/>
	<property name="ext.dir.mavenRepo"		value="C:/Users/Stefan/.m2/repository" />
	<property name="ext.dir.defaultsRepo"	value="${ext.dir.projectRoot}/defaults" />
	<property name="ext.dir.extensions"		value="${dir.dist}/extensions" />

	<property name="main.line"			value="1" />

	   <property name="projectname"	value="FskEncoder-Extensions"/>
	
	<macrodef name="replaceLibrary" >
		
		<attribute name="sourcePath"/>
		<attribute name="fileName"/>
		
		<sequential>
		
			<replaceFile sourcePath="@{sourcePath}" destPath="${dir.dist}/lib/" fileName="@{fileName}" />
		
		</sequential>
	
	</macrodef>


	<macrodef name="replaceConfig" >
		
		<attribute name="sourcePath"/>
		<attribute name="fileName"/>
		
		<sequential>
		
			<echo message="candidate: @{sourcePath}/@{fileName}"/>

			<replaceFile sourcePath="@{sourcePath}" destPath="${dir.dist}/cfg/" fileName="@{fileName}" />
		
		</sequential>
	
	</macrodef>


	<macrodef name="replaceFile" >
		
		<attribute name="sourcePath"/>
		<attribute name="destPath" />
		<attribute name="fileName"/>
		
		<sequential>
		
			<echo message="candidate: @{sourcePath}/@{fileName} -> @{destPath}"/>
			
			<delete file="@{destPath}/@{fileName}" failonerror="no" />
	        <copy file="@{sourcePath}/@{fileName}" 	todir="@{destPath}"/>
		
		</sequential>
	
	</macrodef>
	
	
	<macrodef name="mkManifest" >
		
		<attribute name="location" />
		<attribute name="version" />
		<attribute name="timestamp" />
		
		<sequential>
			<propertyregex property="lineNbr"	input="@{version}" regexp="^([^\.]+)\."					select="\1" />
			<propertyregex property="streamNbr"	input="@{version}" regexp="^[^\.]+\.([^\.]+)\."			select="\1" />
			<propertyregex property="buildNbr"	input="@{version}" regexp="^[^\.]+\.[^\.]+\.([^\.]+)$"	select="\1" />
			
			<echo message="Candidate = @{location}, Version = @{version} ->lineNbr:  ${lineNbr}, streamNbr: ${streamNbr}, buildNbr: ${buildNbr}" />
			
			<delete file="@{location}/MANIFEST.MF" />
	
			<manifest file="@{location}/MANIFEST.MF">
		        <attribute name="Manifest-Version" 	value="1.0"/>
		        <attribute name="Built-By" 			value="${user.name}"/>
		        <attribute name="Project" 			value="${projectname}"/>
		        <attribute name="Modul" 			value="${targetName}"/>
				<attribute name="Main-Line"			value="${lineNbr}"/>
				<attribute name="Stream"			value="${streamNbr}"/>
		        <attribute name="Build" 			value="${buildNbr}"/>
		        <attribute name="Version" 			value="@{version}"/>
		        <attribute name="Build-Date" 		value="@{timestamp}"/>
		    </manifest>
		
		</sequential>
		
	</macrodef>

</project>
